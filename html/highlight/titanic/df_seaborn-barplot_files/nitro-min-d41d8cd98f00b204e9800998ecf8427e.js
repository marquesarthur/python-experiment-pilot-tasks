(function(j){j(function(){var a=[];j(".et_bloom_make_form_visible").removeAttr("style");j('.et_bloom_custom_html_form input[type="radio"], .et_bloom_custom_html_form input[type="checkbox"]').uniform();j("body").on("click","span.et_bloom_close_button",function(){$(j(this).closest(".et_bloom_optin"));return false});function t(t,e){j(t).children("i").toggleClass("et_bloom_icon et_bloom_icon_check")}j("body .et_bloom_custom_field_checkbox input[type=checkbox]:checked").each(function(){t(j(this).next("label"))});j("body").on("click",".et_bloom_custom_field_checkbox label",function(){t(this)});function $(t){t.addClass("et_bloom_exit_animation");setTimeout(function(){if(t.hasClass("et_bloom_trigger_click")){t.removeClass("et_bloom_visible et_bloom_animated et_bloom_exit_animation")}else{t.remove()}},400);j("body").removeClass("et_bloom_popup_active")}function n(t,e){if("logged"===bloomSettings.is_user_logged_in){return}var o=typeof e.data("current_optin_id")!=="undefined"?e.data("current_optin_id"):e.data("optin_id"),i=e.data("page_id"),_=e.data("list_id");var a="et_bloom_optin_".concat(o,"_",_,"_",t);if(l(a)){return}$stats_data=JSON.stringify({type:t,optin_id:o,page_id:i,list_id:_});j.ajax({type:"POST",url:bloomSettings.ajaxurl,data:{action:"bloom_handle_stats_adding",stats_data_array:$stats_data,update_stats_nonce:bloomSettings.stats_nonce}}).done(function(){z(365,a.concat("=true"))})}function o(t){var e=t*24*60*60*1e3;var o=new Date;o.setTime(o.getTime()+e);return"; expires="+o.toUTCString()}function d(t,e){return i()[t]==e}function l(t){return"undefined"!==typeof i()[t]}function i(){var t=document.cookie.split("; ");var e={};for(var o=t.length-1;o>=0;o--){var i=t[o].split("=");e[i[0]]=i[1]}return e}function z(t,e){var e=""==e?"etBloomCookie=true":e;cookieExpire=o(t);document.cookie=e+cookieExpire+"; path=/"}function e(t){var e=window.location.search.substring(1);var o=e.split("&");for(var i=0;i<o.length;i++){var _=o[i].split("=");if(_[0]==t){return _[1]}}}function m(t,e,o,i){if(!t.hasClass("et_bloom_visible")){setTimeout(function(){t.addClass("et_bloom_visible et_bloom_animated");$stats_data_container=0!=t.find(".et_bloom_custom_html_form").length?t.find(".et_bloom_custom_html_form"):t.find(".et_bloom_submit_subscription");n("imp",$stats_data_container);if(""!=o){z(o,i)}if(j(".et_bloom_resize").length){j(".et_bloom_resize.et_bloom_visible").each(function(){q(j(this),true,0)})}_(t)},e)}}function _(t){setTimeout(function(){t.find(".et_bloom_image").addClass("et_bloom_visible_image")},500)}function s(t,e){var o=t.find(".et_bloom_custom_html_form").length?t.find(".et_bloom_custom_html_form"):t.find(".et_bloom_submit_subscription"),i=o.data("page_id"),_=o.data("optin_id"),a=o.data("list_id");if(!t.hasClass("et_bloom_animated")){var n=t.data("cookie_duration")?t.data("cookie_duration"):false,l=d("et_bloom_subscribed_to_"+_+a,"true");if((false!==n&&!d("etBloomCookie_"+_,"true")||false==n)&&!l){if(false!==n){m(t,e,n,"etBloomCookie_"+_+"=true")}else{m(t,e,"","")}}}}function r(t,e){var o=0,i=t.find(".et_bloom_custom_html_form").length?t.find(".et_bloom_custom_html_form"):t.find(".et_bloom_submit_subscription"),_=i.data("page_id"),a=i.data("optin_id");list_id=i.data("list_id");if(!t.hasClass("et_bloom_animated")){var n=t.data("cookie_duration")?t.data("cookie_duration"):false,l=d("et_bloom_subscribed_to_"+a+list_id,"true");if(true==e){var s=j(".et_bloom_bottom_trigger").length?j(".et_bloom_bottom_trigger").offset().top:j(document).height()-500}else{var r=t.data("scroll_pos")>100?100:t.data("scroll_pos"),s=100==r?j(document).height()-50:j(document).height()*r/100}j(window).on("scroll",function(){if((false!==n&&!d("etBloomCookie_"+a,"true")||false==n)&&!l){if(j(window).scrollTop()+j(window).height()>s){if(0==o){if(false!==n){m(t,0,n,"etBloomCookie_"+a+"=true")}else{m(t,0,"","")}o++}}}})}}j.fn.isInViewport=function(){var t=j(this).offset().top;var e=t+j(this).outerHeight()||0;var o=j(window).scrollTop();var i=o+j(window).height();return e>o&&t<i};var c=j(".et_bloom_inline_form .et_bloom_submit_subscription, .et_bloom_widget_content .et_bloom_submit_subscription, .et_bloom_custom_html_form");if(c.length>0){var f=0;j(window).on("scroll.et_bloom_impressions",function(){c.each(function(){if(!j(this).hasClass("et_bloom_impression_recorded")&&j(this).isInViewport()){j(this).addClass("et_bloom_impression_recorded");f++;n("imp",j(this))}});if(f>=c.length){j(window).off("scroll.et_bloom_impressions")}})}if(j(".et_bloom_auto_popup").length){j(".et_bloom_auto_popup:not(.et_bloom_visible)").each(function(){var t=j(this),e=""!==t.data("delay")?t.data("delay")*1e3:0;s(t,e)})}if(j(".et_bloom_trigger_bottom").length){j(".et_bloom_trigger_bottom:not(.et_bloom_visible)").each(function(){r(j(this),true)})}if(j(".et_bloom_scroll").length){j(".et_bloom_scroll:not(.et_bloom_visible)").each(function(){r(j(this),false)})}if(j(".et_bloom_trigger_click").length){j(".et_bloom_trigger_click:not(.et_bloom_visible)").each(function(){var t=j(this),e=t.attr("data-trigger_click");if(typeof e!=="undefined"){j("body").on("click",e,function(){m(t,0,"","");return false})}})}if(j(".et_bloom_trigger_idle").length){j(".et_bloom_trigger_idle:not(.et_bloom_visible)").each(function(){var t=j(this),e=t.find(".et_bloom_custom_html_form").length?t.find(".et_bloom_custom_html_form"):t.find(".et_bloom_submit_subscription"),o=e.data("page_id"),i=e.data("optin_id"),_=e.data("list_id");if(!t.hasClass("et_bloom_animated")){var a=t.data("cookie_duration")?t.data("cookie_duration"):false,n=d("et_bloom_subscribed_to_"+i+_,"true");$idle_timeout=""!==t.data("idle_timeout")?t.data("idle_timeout")*1e3:3e4,$delay=0;if((false!==a&&!d("etBloomCookie_"+i,"true")||false==a)&&!n){j(document).idleTimer($idle_timeout);j(document).on("idle.idleTimer",function(){if(false!==a){m(t,$delay,a,"etBloomCookie_"+i+"=true")}else{m(t,$delay,"","")}})}}})}if("true"==e("et_bloom_popup")){j(".et_bloom_after_comment").each(function(){s(j(this),0)})}if(j(".et_bloom_after_order").length){j(".et_bloom_after_purchase").each(function(){s(j(this),0)})}if(j(".et_bloom_locked_container").length){var b=0;j(".et_bloom_locked_container").each(function(){var t=j(this),e=t.find(".et_bloom_locked_content"),o=t.find(".et_bloom_locked_form"),i=t.data("page_id"),_=t.data("optin_id");t.data("container_id",b);a.push(e);if(d("et_bloom_unlocked"+_+i,"true")){e.css({display:"block"});o.remove()}else{e.remove();n("imp",t)}b++})}j("body").on("click",".et_bloom_locked_container .et_bloom_submit_subscription",function(){var t=j(this).closest(".et_bloom_locked_container"),e=t.data("container_id"),o=t.data("page_id"),i=typeof t.data("current_optin_id")!=="undefined"?t.data("current_optin_id"):t.data("optin_id");v(j(this),t,e,o,i);return false});j("body").on("click",'.et_bloom_locked_container .et_bloom_custom_html_form input[type="submit"], .et_bloom_locked_container .et_bloom_custom_html_form button[type="submit"]',function(){var t=j(this).closest(".et_bloom_locked_container"),e=t.data("container_id"),o=t.data("page_id"),i=t.data("optin_id");S(t,e,o,i)});function S(t,e,o,i){z(365,"et_bloom_unlocked"+i+o+"=true");t.find(".et_bloom_locked_form").replaceWith(a[e]);t.find(".et_bloom_locked_content").css({display:"block"})}if(j(".et_bloom_below_post").length){if(j("body").hasClass("et_pb_pagebuilder_layout")){var u=j(".et_bloom_below_post"),p='<div class="et_pb_row"><div class="et_pb_column et_pb_column_4_4"></div></div>';if(u.length){var h=j(".et_pb_post_content .et_pb_section, .et_pb_fullwidth_post_content .et_pb_section").not(".et_pb_fullwidth_section");if(h.length===0){h=j(".et-l--body .et_pb_section").not(".et_pb_fullwidth_section")}if(h.length===0){h=j(".et_pb_section").not(".et-l--header .et_pb_section").not(".et-l--footer .et_pb_section").not(".et_pb_fullwidth_section")}h.last().append(p).find(".et_pb_row").last().find(".et_pb_column").append(u)}}}function q(t,e,o){var i=t.find(".et_bloom_form_container"),_=i.hasClass("et_bloom_popup_container")?j(window).height()-40:j(window).height()-20,a=0,n=i.parent().hasClass("et_bloom_flyin")?.03:.05,n=i.hasClass("et_bloom_with_border")?n+.03:n,l=i.hasClass("breakout_edge")?.95:1,s=i.hasClass("et_bloom_border_dashed")?4:0,r=i.find("form").innerHeight()+o,d=true==e?5:0,m=false;var c,f=i.parent(),b=f.hasClass("et_bloom_visible");if(!b){c=f.attr("style");f.css({visibility:"hidden",display:"block"})}i.find(".et_bloom_form_header").css({height:""});i.find(".et_bloom_form_content").css({"min-height":""});i.find(".et_bloom_form_container_wrapper").css({height:"","max-height":""});var u=i.find(".et_bloom_form_container_wrapper").height();if(!b){f.attr("style",c?c:"")}i.find(".et_bloom_form_container_wrapper").css({"max-height":_-20+"px"});if(768>j("body").outerWidth()+15||i.hasClass("et_bloom_form_bottom")){if(i.hasClass("et_bloom_form_right")||i.hasClass("et_bloom_form_left")){i.find(".et_bloom_form_header").css({height:"auto"})}a=u+30+d;if(i.hasClass("et_bloom_form_right")||i.hasClass("et_bloom_form_left")){i.find(".et_bloom_form_container_wrapper").css({height:a-30+s+"px"});i.find(".et_bloom_form_content").css({"min-height":""})}}else{a=u+30+o;if((i.hasClass("et_bloom_form_right")||i.hasClass("et_bloom_form_left"))&&0!==parseInt(a)){m=true;var p=g(i);if(p>a){a=p}k(i,a,l,s)}}if(i.hasClass("et_bloom_popup_container")){var h=j(window).height()/2-i.innerHeight()/2;if(0<h){i.css({top:h+"px"})}}if(a>_){i.find(".et_bloom_form_container_wrapper").addClass("et_bloom_vertical_scroll");if(m){var v=g(i);if(v>a){k(i,v,l,s)}}}else{i.find(".et_bloom_form_container_wrapper").removeClass("et_bloom_vertical_scroll")}if(t.hasClass("et_bloom_popup")){j("body").addClass("et_bloom_popup_active")}}function g(t){var e=t.find(".et_bloom_form_header");var o=t.find(".et_bloom_form_text").innerHeight()+(e.innerHeight()-e.height());return o}function k(t,e,o=1,i=0){t.find(".et_bloom_form_container_wrapper").css({height:e});t.find(".et_bloom_form_header").css({height:e*o-i});t.find(".et_bloom_form_content").css({"min-height":e-i})}j("body").on("click",".et_bloom_submit_subscription:not(.et_bloom_submit_subscription_locked)",function(){v(j(this),"","","","");return false});function v(e,o,i,_,a){var n=e.parents("form");var l=e.data("list_id");var t=e.data("account");var b=e.data("service");var s=n.find(".et_bloom_subscribe_name input").val();var r=undefined!==n.find(".et_bloom_subscribe_last input").val()?n.find(".et_bloom_subscribe_last input").val():"";var d=n.find(".et_bloom_subscribe_email input").val();var m=e.data("page_id");var c=e.data("optin_id");var f=n.closest(".et_bloom_optin");var u=f.hasClass("et_bloom_popup")||f.hasClass("et_bloom_flyin");var p=e.closest(".et_bloom_success_action");var h=p.length>0?p.parent().data("success_action_details").split("|"):[];var v=2===h.length?h[0]:"";var g=""!==v?h[1]:"";var k=e.data("ip_address");var y=n.find(".et_bloom_fields");var w=y.find('.et_bloom_custom_field input[type=text], .et_bloom_checkbox_handle, [data-field_type="radio"], textarea, select');var C={};var x=true;var T=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;n.find(".et_bloom_warn_field").removeClass("et_bloom_warn_field");if(n.length>0&&typeof n[0].reportValidity==="function"){x=n[0].reportValidity()}w.each(function(){var t=j(this);var e=false;var o=t.attr("data-id");var i=typeof t.data("field_type")!=="undefined"?t.data("field_type"):"text";if("checkbox"===i||"radio"===i){e=t.closest(".et_bloom_custom_field")}var _=t.val();var a=typeof t.data("required_mark")!=="undefined"?t.data("required_mark"):"not_required";var n=typeof t.data("original_id")!=="undefined"?t.data("original_id"):"";var l=false;var s;if("radio"===i){if(0!==e.find('input[type="radio"]').length){var r=e.find('input[type="radio"]').first();a=typeof r.data("required_mark")!=="undefined"?r.data("required_mark"):"not_required";_="";if(e.find('input[type="radio"]:checked')){_=e.find('input[type="radio"]:checked').val()}}if(!j.isEmptyObject(_)){C[o]=_}if(0===e.find('input[type="radio"]:checked').length){l=true}if(_){C[o]=_}}else if("checkbox"===i){_={};if(0!==e.find('input[type="checkbox"]').length){var d=e.find(".et_bloom_checkbox_handle");a=typeof d.data("required_mark")!=="undefined"?d.data("required_mark"):"not_required";if(e.find('input[type="checkbox"]:checked').length>0){e.find('input[type="checkbox"]:checked').each(function(){var t=j(this).data("id");_[t]=j(this).val()})}}if(!j.isEmptyObject(_)){C[o]=_}if(0===e.find('input[type="checkbox"]:checked').length){l=true}}else if("ontraport"===b&&"select"===i){var m=t.find(":selected");C[o]=m.length>0?m.data("id"):_}else{C[o]=_}if("required"===a&&(""===_||true===l)){if(false===e){t.addClass("et_bloom_warn_field")}else{e.addClass("et_bloom_warn_field")}x=false}if("email"===i){var c=_.trim().toLowerCase();var f=T.test(c);if(""!==c&&!f){t.addClass("et_bloom_warn_field");x=false}}});if(!x){return}if(""==d){n.find(".et_bloom_subscribe_email input").addClass("et_bloom_warn_field")}else{k=k?"true":"false";$subscribe_data=JSON.stringify({list_id:l,account_name:t,service:b,name:s,email:d,page_id:m,optin_id:c,last_name:r,ip_address:k});j.ajax({type:"POST",dataType:"json",url:bloomSettings.ajaxurl,data:{action:"bloom_subscribe",subscribe_data_array:$subscribe_data,custom_fields:C,subscribe_nonce:bloomSettings.subscribe_nonce},beforeSend:function(t){e.addClass("et_bloom_button_text_loading");e.find(".et_bloom_subscribe_loader").css({display:"block"})},success:function(t){e.removeClass("et_bloom_button_text_loading");e.find(".et_bloom_subscribe_loader").css({display:"none"});if(t){if(""!==o&&(t.success||"Invalid email"!==t.error)){S(o,i,_,a)}else{if(t.error){n.find(".et_bloom_error_message").remove();n.prepend('<h2 class="et_bloom_error_message">'+t.error+"</h2>");n.parent().parent().find(".et_bloom_form_header").addClass("et_bloom_with_error")}if(t.success&&""==o){z(365,"et_bloom_subscribed_to_"+c+l+"=true");if(""===v||""===g){n.parent().find(".et_bloom_success_message").addClass("et_bloom_animate_message");n.parent().find(".et_bloom_success_container").addClass("et_bloom_animate_success");n.remove()}else{window.location=g}if(u&&f.hasClass("et_bloom_auto_close")){setTimeout(function(){$(f)},1400)}}}if(u){q(f,false,50)}}}})}}j("body").on("click",'.et_bloom_custom_html_form input[type="submit"], .et_bloom_custom_html_form button[type="submit"]',function(){var t=j(this),e=t.closest(".et_bloom_custom_html_form");n("con",e)});j(window).on("resize",function(){if(j(".et_bloom_resize").length){j(".et_bloom_resize").each(function(){q(j(this),false,0)})}})})})(jQuery);